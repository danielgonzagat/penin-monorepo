# Configuração de Proteção Geográfica - Bloqueio de Países Não-Brasil
# Autor: Sistema de Segurança
# Data: 2025-01-17

# Mapa de países bloqueados (todos exceto Brasil)
geo $allowed_country {
    default 0;
    
    # Países permitidos (apenas Brasil)
    177.0.0.0/8    1;  # Brasil Telecom
    179.0.0.0/8    1;  # Brasil Telecom
    186.0.0.0/8    1;  # Brasil Telecom
    187.0.0.0/8    1;  # Brasil Telecom
    189.0.0.0/8    1;  # Brasil Telecom
    200.0.0.0/8    1;  # Brasil Telecom
    201.0.0.0/8    1;  # Brasil Telecom
    138.0.0.0/8    1;  # Brasil Telecom
    143.0.0.0/8    1;  # Brasil Telecom
    150.0.0.0/8    1;  # Brasil Telecom
    152.0.0.0/8    1;  # Brasil Telecom
    168.0.0.0/8    1;  # Brasil Telecom
    170.0.0.0/8    1;  # Brasil Telecom
    171.0.0.0/8    1;  # Brasil Telecom
    172.0.0.0/8    1;  # Brasil Telecom
    173.0.0.0/8    1;  # Brasil Telecom
    174.0.0.0/8    1;  # Brasil Telecom
    175.0.0.0/8    1;  # Brasil Telecom
    176.0.0.0/8    1;  # Brasil Telecom
    178.0.0.0/8    1;  # Brasil Telecom
    180.0.0.0/8    1;  # Brasil Telecom
    181.0.0.0/8    1;  # Brasil Telecom
    182.0.0.0/8    1;  # Brasil Telecom
    183.0.0.0/8    1;  # Brasil Telecom
    184.0.0.0/8    1;  # Brasil Telecom
    185.0.0.0/8    1;  # Brasil Telecom
    188.0.0.0/8    1;  # Brasil Telecom
    190.0.0.0/8    1;  # Brasil Telecom
    191.0.0.0/8    1;  # Brasil Telecom
    192.0.0.0/8    1;  # Brasil Telecom
    193.0.0.0/8    1;  # Brasil Telecom
    194.0.0.0/8    1;  # Brasil Telecom
    195.0.0.0/8    1;  # Brasil Telecom
    196.0.0.0/8    1;  # Brasil Telecom
    197.0.0.0/8    1;  # Brasil Telecom
    198.0.0.0/8    1;  # Brasil Telecom
    199.0.0.0/8    1;  # Brasil Telecom
    
    # IPs específicos conhecidos do Brasil
    200.160.2.3/32 1;  # Brasil
    200.160.2.4/32 1;  # Brasil
    200.160.2.5/32 1;  # Brasil
    200.160.2.6/32 1;  # Brasil
    200.160.2.7/32 1;  # Brasil
    200.160.2.8/32 1;  # Brasil
    200.160.2.9/32 1;  # Brasil
    200.160.2.10/32 1; # Brasil
}

# Mapa de países bloqueados (todos exceto Brasil)
geo $blocked_country {
    default 1;  # Por padrão, bloqueia todos
    
    # Países permitidos (apenas Brasil)
    177.0.0.0/8    0;  # Brasil Telecom
    179.0.0.0/8    0;  # Brasil Telecom
    186.0.0.0/8    0;  # Brasil Telecom
    187.0.0.0/8    0;  # Brasil Telecom
    189.0.0.0/8    0;  # Brasil Telecom
    200.0.0.0/8    0;  # Brasil Telecom
    201.0.0.0/8    0;  # Brasil Telecom
    138.0.0.0/8    0;  # Brasil Telecom
    143.0.0.0/8    0;  # Brasil Telecom
    150.0.0.0/8    0;  # Brasil Telecom
    152.0.0.0/8    0;  # Brasil Telecom
    168.0.0.0/8    0;  # Brasil Telecom
    170.0.0.0/8    0;  # Brasil Telecom
    171.0.0.0/8    0;  # Brasil Telecom
    172.0.0.0/8    0;  # Brasil Telecom
    173.0.0.0/8    0;  # Brasil Telecom
    174.0.0.0/8    0;  # Brasil Telecom
    175.0.0.0/8    0;  # Brasil Telecom
    176.0.0.0/8    0;  # Brasil Telecom
    178.0.0.0/8    0;  # Brasil Telecom
    180.0.0.0/8    0;  # Brasil Telecom
    181.0.0.0/8    0;  # Brasil Telecom
    182.0.0.0/8    0;  # Brasil Telecom
    183.0.0.0/8    0;  # Brasil Telecom
    184.0.0.0/8    0;  # Brasil Telecom
    185.0.0.0/8    0;  # Brasil Telecom
    188.0.0.0/8    0;  # Brasil Telecom
    190.0.0.0/8    0;  # Brasil Telecom
    191.0.0.0/8    0;  # Brasil Telecom
    192.0.0.0/8    0;  # Brasil Telecom
    193.0.0.0/8    0;  # Brasil Telecom
    194.0.0.0/8    0;  # Brasil Telecom
    195.0.0.0/8    0;  # Brasil Telecom
    196.0.0.0/8    0;  # Brasil Telecom
    197.0.0.0/8    0;  # Brasil Telecom
    198.0.0.0/8    0;  # Brasil Telecom
    199.0.0.0/8    0;  # Brasil Telecom
}

# Rate limiting removido para evitar conflitos

# Logging personalizado definido no nginx.conf principal

# Configuração de bloqueio
map $blocked_country $block_access {
    1 "blocked";
    0 "allowed";
}

# Página de erro personalizada para países bloqueados
error_page 403 /blocked_country.html;